<div class="card {{ '' if image.enabled else 'is-disabled' }}" id="img-{{ image.id }}">
  <img src="/static/thumbs/{{ image.filename }}" alt="" style="width:100%;border-radius:8px">
  <div class="image-info">
    <div class="title-display" id="title-display-{{ image.id }}">{{ image.title or image.original_name }}</div>
    <div class="title-edit" id="title-edit-{{ image.id }}" style="display: none;">
      <input type="text" id="title-input-{{ image.id }}" value="{{ image.title or image.original_name }}" placeholder="Image title">
      <textarea id="desc-input-{{ image.id }}" placeholder="Description">{{ image.description }}</textarea>
      
      <!-- Aspect ratio preservation option -->
      <div class="aspect-ratio-option">
        <div class="aspect-ratio-option-control">
        
          <input type="checkbox" id="preserve-aspect-{{ image.id }}" 
                 {{ 'checked' if image.preserve_aspect_ratio else '' }}
                 onchange="toggleAspectRatioMode('{{ image.id }}')">
          <label for="preserve-aspect-{{ image.id }}">Preserve original aspect ratio</label>
        </div>
        <small class="aspect-help">When checked, image keeps original proportions with black borders. When unchecked, image fills display by cropping.</small>
      </div>
      
      <!-- Crop controls -->
      <div class="crop-controls" id="crop-controls-{{ image.id }}" 
           style="{{ 'opacity: 0.5; pointer-events: none;' if image.preserve_aspect_ratio else '' }}">
        <div class="crop-header" onclick="toggleCropSettings('{{ image.id }}')">
          <span>Crop Settings</span>
          <span class="crop-toggle" id="crop-toggle-{{ image.id }}">‚ñº</span>
        </div>
        <div class="crop-content" id="crop-content-{{ image.id }}" style="display: none;">
          <div class="crop-container" id="crop-container-{{ image.id }}">
            <img src="/static/uploads/{{ image.filename }}" id="crop-preview-{{ image.id }}" class="crop-image">
            <div class="crop-selector" id="crop-selector-{{ image.id }}">
              <div class="crop-handle crop-handle-nw"></div>
              <div class="crop-handle crop-handle-ne"></div>
              <div class="crop-handle crop-handle-sw"></div>
              <div class="crop-handle crop-handle-se"></div>
            </div>
          </div>
          <div class="crop-info">
            <span class="crop-instructions-desktop">Drag to select crop area. Aspect ratio locked to display settings.</span>
            <span class="crop-instructions-mobile">Touch and drag to select crop area. Use corner handles to resize.</span>
            <div class="crop-values">
              Position: <span id="crop-display-{{ image.id }}">{{ image.crop_x or 0 }}%, {{ image.crop_y or 0 }}%</span> | 
              Size: <span id="crop-size-{{ image.id }}">{{ image.crop_width or 100 }}% √ó {{ image.crop_height or 100 }}%</span>
            </div>
          </div>
        </div>
        <!-- Hidden inputs to store crop values -->
        <input type="hidden" id="crop-x-{{ image.id }}" value="{{ image.crop_x or 0 }}">
        <input type="hidden" id="crop-y-{{ image.id }}" value="{{ image.crop_y or 0 }}">
        <input type="hidden" id="crop-width-{{ image.id }}" value="{{ image.crop_width or 100 }}">
        <input type="hidden" id="crop-height-{{ image.id }}" value="{{ image.crop_height or 100 }}">
      </div>
      
      <div class="edit-buttons">
        <button class="save-edit" data-id="{{ image.id }}">Save</button>
        <button class="cancel-edit" data-id="{{ image.id }}">Cancel</button>
      </div>
    </div>
    {% if image.description %}
      <div class="description" id="desc-display-{{ image.id }}">{{ image.description }}</div>
    {% endif %}
  </div>
  <div class="row" style="justify-content:space-between;margin-top:.5rem">
    <small>Shown {{ image.times_shown }} times</small>
  </div>
  <div class="row" style="margin-top:.5rem">
    <button
      class="toggle-enabled"
      data-id="{{ image.id }}"
      aria-pressed="{{ 'true' if image.enabled else 'false' }}">
      {{ 'Disable' if image.enabled else 'Enable' }}
    </button>
    <button class="edit-image" data-id="{{ image.id }}">‚úèÔ∏è</button>
    <button class="show-now" data-id="{{ image.id }}">‚ñ∂Ô∏è</button>
    <button class="delete-image" data-id="{{ image.id }}">üóëÔ∏è</button>
  </div>
</div>
